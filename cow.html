<html>
	<head>
		<meta charset="utf-8">
		<title>Agricowture Web</title>
		<style>
		html {
			height: 100%;
		}
		body {
			height: 100%;
		}
		#map {
			height: 100%;
			width: 100%;
		}
		</style>
		<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
		<script src="https://maps.google.com/maps/api/js?key=AIzaSyAoHtZ_FzkEevFk_NMJ9q3KBPQAw08CDcg&language=ja"></script>
		<script>
		window.onload = function () {
			var dt = "";
			$.ajax({
				type: "GET",
				url: "https://agricowture.herokuapp.com/get",
				dataType: "json",
				data: dt
			}).done((data) => {
				var md=[];
				var marker = [];
				var infoWindow = [];
				for(let i=0;i<data.length;i++) {
					md[i] = {
						name: "牛" + String(data[i].CowID),
						lat: Number(data[i].Lat),
						lng: Number(data[i].Lng)
					}
				}
				var mapLatLng = new google.maps.LatLng({
					lat: md[0]['lat'],
					lng: md[0]['lng']
				});
				var Options = {
					zoom: 15, //地図の縮尺値
					center: mapLatLng, //地図の中心座標
					mapTypeId: 'roadmap' //地図の種類
				};
				function clickEvent(i) {
					infoWindow[i].open(map, marker[i]);
					google.maps.event.addListener(infoWindow[i],"closeclick",function() {
						google.maps.event.addListenerOnce(marker[i], "click", function(event) {
							infoWindow[i].open(map.marker[i])
						});
					});
				}
				var map = new google.maps.Map(document.getElementById('map'), Options);				
				for (var i = 0; i < md.length; i++) {
        				var markerLatLng = new google.maps.LatLng({
						lat: md[i]['lat'],
						lng: md[i]['lng']
					}); // 緯度経度のデータ作成
        				marker[i] = new google.maps.Marker({ // マーカーの追加
         					position: markerLatLng, // マーカーを立てる位置を指定
            					map: map // マーカーを立てる地図を指定
       					});
					infoWindow[i] = new google.maps.InfoWindow({
						content: md[i]['name']
					});
					clickEvent(i);
				}
			}).fail((data) => {
				console.log(data.responseText);
			});
		}
		</script>
	</head>
	<body>
		<div id="map"></div>
	</body>
</html>
